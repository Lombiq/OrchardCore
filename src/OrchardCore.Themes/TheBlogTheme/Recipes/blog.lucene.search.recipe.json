{
  "name": "Blog.Lucene.Search",
  "displayName": "Blog - Lucene Search",
  "description": "Creates Lucene settings, permission and indices.",
  "author": "The Orchard Core Team",
  "website": "https://orchardcore.net",
  "version": "1.0.0",
  "issetuprecipe": false,
  "categories": [ "default" ],
  "tags": [ "blog", "lucene" ],

  "variables": {
    "searchIndexProfileId": "[js:uuid()]"
  },

  "steps": [
    {
      "name": "feature",
      "enable": [
        "OrchardCore.Search",
        "OrchardCore.Search.Lucene"
      ]
    },
    {
      "name": "CreateOrUpdateIndexProfile",
      "indexes": [
        {
          "Id": "[js: variables('searchIndexProfileId')]",
          "IndexName": "Search",
          "ProviderName": "Lucene",
          "Type": "Content",
          "Name": "Search",
          "Properties": {
            "LuceneIndexMetadata": {
              "StoreSourceData": false,
              "AnalyzerName": "standardanalyzer",
              "IndexMappings": {
                "KeyFieldName": "ContentItemId",
                "Fields": [
                  "ContentItemId",
                  "ContentItemVersionId",
                  "Content.ContentItem.FullText",
                  "Content.BodyAspect.Body",
                  "Content.ContentItem.DisplayText.Analyzed",
                  "Content.ContentItem.DisplayText.keyword",
                  "Content.ContentItem.DisplayText.Normalized",
                  "Content.ContentItem.ContentType",
                  "Content.ContentItem.CreatedUtc",
                  "Content.ContentItem.Latest",
                  "Content.ContentItem.Owner",
                  "Content.ContentItem.Author",
                  "Content.ContentItem.ModifiedUtc",
                  "Content.ContentItem.Published",
                  "Content.ContentItem.PublishedUtc"
                ]
              }
            },
            "ContentIndexMetadata": {
              "IndexLatest": false,
              "IndexedContentTypes": [
                "Article",
                "Blockquote",
                "Blog",
                "BlogPost",
                "Container",
                "Image",
                "LinkMenuItem",
                "Menu",
                "Page",
                "Paragraph",
                "RawHtml"
              ],
              "Culture": "any"
            },
            "LuceneIndexDefaultQueryMetadata": {
              "DefaultVersion": "LUCENE_30",
              "QueryAnalyzerName": "standardanalyzer",
              "AllowLuceneQueries": false,
              "DefaultSearchFields": [
                "Content.ContentItem.FullText"
              ]
            }
          },
          "IndexLatest": false,
          "Culture": "any",
          "IndexedContentTypes": [
            "Article",
            "Blockquote",
            "Blog",
            "BlogPost",
            "Container",
            "Image",
            "LinkMenuItem",
            "Menu",
            "Page",
            "Paragraph",
            "RawHtml"
          ]
        }
      ]
    },
    {
      // Create the search settings.
      "name": "Settings",
      "SearchSettings": {
        "DefaultIndexProfileName": "[js: variables('searchIndexProfileId')]"
      }
    },
    {
      "name": "RebuildIndex",
      "includeAll": false,
      "indexNames": [
        "Search"
      ]
    },
    {
      // Create the search index permissions.
      "name": "Roles",
      "Roles": [
        {
          "Name": "Anonymous",
          "Description": "Anonymous role",
          "Permissions": [
            "ViewContent",
            "QueryIndex_Search"
          ]
        }
      ]
    }
  ]
}
